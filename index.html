<!DOCTYPE html>
<html>
<head>
    <title>Pharmaceutical Supply Chain</title>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.3.0/dist/web3.min.js"></script>
</head>
<body>
    <h1>Pharmaceutical Supply Chain</h1>

    <h2>Add User</h2>
    <input type="text" id="userAddress" placeholder="User Address">
    <select id="userRole">
        <option value="0">Admin</option>
        <option value="1">Supplier</option>
        <option value="2">Manufacturer</option>
        <option value="3">Transporter</option>
        <option value="4">LogisticWarehouse</option>
        <option value="5">Distributor</option>
        <option value="6">PharmacyWarehouse</option>
        <option value="7">LogisticEmployee</option>
        <option value="8">Inspector</option>
    </select>
    <button onclick="addUser()">Add User</button>

    <h2>Add Product</h2>
    <input type="text" id="productName" placeholder="Product Name">
    <input type="number" id="productQuantity" placeholder="Product Quantity">
    <button onclick="addProduct()">Add Product</button>

    <h2>Add Shipment</h2>
    <input type="number" id="shipmentProductId" placeholder="Product ID">
    <input type="text" id="shipmentOrigin" placeholder="Origin">
    <input type="text" id="shipmentDestination" placeholder="Destination">
    <input type="text" id="shipmentDepartureDate" placeholder="Departure Date">
    <input type="text" id="shipmentArrivalDate" placeholder="Expected Arrival Date">
    <button onclick="addShipment()">Add Shipment</button>

    <script>
        let web3;
        let contract;

        // ABI and contract address
        const abi = [
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_quantity",
				"type": "uint256"
			}
		],
		"name": "addProduct",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_origin",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_destination",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_departureDate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_expectedArrivalDate",
				"type": "string"
			}
		],
		"name": "addShipment",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_userAddress",
				"type": "address"
			},
			{
				"internalType": "enum PharmaceuticalSupplyChain.Role",
				"name": "_role",
				"type": "uint8"
			}
		],
		"name": "addUser",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_quantity",
				"type": "uint256"
			}
		],
		"name": "updateProduct",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			}
		],
		"name": "getProduct",
		"outputs": [
			{
				"components": [
					{
						"internalType": "uint256",
						"name": "productId",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "quantity",
						"type": "uint256"
					},
					{
						"internalType": "address",
						"name": "currentOwner",
						"type": "address"
					}
				],
				"internalType": "struct PharmaceuticalSupplyChain.Product",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_shipmentId",
				"type": "uint256"
			}
		],
		"name": "getShipment",
		"outputs": [
			{
				"components": [
					{
						"internalType": "uint256",
						"name": "shipmentId",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "productId",
						"type": "uint256"
					},
					{
						"internalType": "string",
						"name": "origin",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "destination",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "departureDate",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "expectedArrivalDate",
						"type": "string"
					}
				],
				"internalType": "struct PharmaceuticalSupplyChain.Shipment",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			}
		],
		"name": "getTransferHistory",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "from",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "to",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "date",
						"type": "string"
					}
				],
				"internalType": "struct PharmaceuticalSupplyChain.TransferDetail[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "productCounter",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "products",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "productId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "quantity",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "currentOwner",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "shipmentCounter",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "shipments",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "shipmentId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "productId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "origin",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "destination",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "departureDate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "expectedArrivalDate",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "transferHistories",
		"outputs": [
			{
				"internalType": "string",
				"name": "from",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "to",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "date",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "users",
		"outputs": [
			{
				"internalType": "address",
				"name": "userAddress",
				"type": "address"
			},
			{
				"internalType": "enum PharmaceuticalSupplyChain.Role",
				"name": "role",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
        const contractAddress = '0xd9145CCE52D386f254917e481eB44e9943F39138';

        window.addEventListener('load', async () => {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                await window.ethereum.enable();
            } else {
                console.log('No Ethereum browser extension detected');
            }

            contract = new web3.eth.Contract(abi, contractAddress);
        });

        async function addUser() {
            const address = document.getElementById('userAddress').value;
            const role = document.getElementById('userRole').value;
            const accounts = await web3.eth.getAccounts();
            await contract.methods.addUser(address, role).send({ from: accounts[0] });
        }

        async function addProduct() {
            const name = document.getElementById('productName').value;
            const quantity = document.getElementById('productQuantity').value;
            const accounts = await web3.eth.getAccounts();
            await contract.methods.addProduct(name, quantity).send({ from: accounts[0] });
        }

        async function addShipment() {
            const productId = document.getElementById('shipmentProductId').value;
            const origin = document.getElementById('shipmentOrigin').value;
            const destination = document.getElementById('shipmentDestination').value;
            const departureDate = document.getElementById('shipmentDepartureDate').value;
            const arrivalDate = document.getElementById('shipmentArrivalDate').value;
            const accounts = await web3.eth.getAccounts();
            await contract.methods.addShipment(productId, origin, destination, departureDate, arrivalDate).send({ from: accounts[0] });
        }
    </script>
</body>
</html>
